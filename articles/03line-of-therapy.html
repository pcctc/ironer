<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Line of therapy algorithm • ironer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Line of therapy algorithm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ironer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01data-documentation-medidata.html">Medidata data documentation</a></li>
    <li><a class="dropdown-item" href="../articles/02data-documentation-proms.html">PROMS data documentation</a></li>
    <li><a class="dropdown-item" href="../articles/03line-of-therapy.html">Line of therapy algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/04treatment-mapping.html">Treatment mapping</a></li>
    <li><a class="dropdown-item" href="../articles/05comprehensive_ironman_treatment_tutorial.html">Comprehensive Ironman Treatment Tutorial</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pcctc/ironer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="03line-of-therapy_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="03line-of-therapy_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="03line-of-therapy_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="03line-of-therapy_files/datatables-binding-0.33/datatables.js"></script><link href="03line-of-therapy_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="03line-of-therapy_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="03line-of-therapy_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="03line-of-therapy_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="03line-of-therapy_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Line of therapy algorithm</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pcctc/ironer/blob/main/vignettes/articles/03line-of-therapy.Rmd" class="external-link"><code>vignettes/articles/03line-of-therapy.Rmd</code></a></small>
      <div class="d-none name"><code>03line-of-therapy.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The line of therapy (lot) algorithm <strong>approximately</strong>
assigns line of therapy based on the logic described below.</p>
<p>During a manual review process, we have identified situations where
results of the algorithm do not align with the line of therapy
assessment of those with domain expertise.</p>
<p>We are making this algorithm available in the hopes that it can
provide a rough approximation, but please note it is not gold standard
truth. PCCTC is working towards electronic data base updates to more
easily and accurately collect line of therapy information. The current
version of the algorithm is reasonably sufficient to extract first line
of therapy.</p>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<ul>
<li><p>Overall line of therapy: use <code>ca_cm_derived</code> table for
a full listing of prior and current treatments.</p></li>
<li><p>On study line of therapy: either use <code>ca_cm_derived</code>
and filter on treatments that occur after the consent date.</p></li>
<li><p>Disease state line of therapy: researchers may be interested in
line of therapy after a specific disease state diagnosis, like mHSPC. If
so, use <code>ca_cm_derived</code> and filter on treatments that occur
after the disease state diagnosis.</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Remove rows with <code>trt_treatment_category</code> equal to any
of “ADT”, “Bisphosphonates”, “Steroid”, as these are generally not
considered a standalone line of therapy.</p></li>
<li><p>If no start date is listed, remove the row from consideration;
future data cuts will hopefully be queried and have more information
available.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="line-of-therapy-algorithm">Line of therapy algorithm<a class="anchor" aria-label="anchor" href="#line-of-therapy-algorithm"></a>
</h3>
<p>The <code><a href="../reference/assign_lot.html">assign_lot()</a></code> does this internally.</p>
<ol style="list-style-type: decimal">
<li><p>Sort the table by treatment start date, and assign the first line
(1L) as the first entry, along with entries that occur within a 30 day
window of this date as a combo therapy.</p></li>
<li><p>End line 1 (or subsequent lines) when a treatment stop date is
listed for all therapies in that line. If no end date is entered, use
information from step 8 if a new LOT is entered.</p></li>
<li><p>Any new treatments listed after 30 days of an LOT start date
become a new LOT. Any treatments listed within 30 days of this new LOT
start are marked as a combo therapy for that LOT.</p></li>
<li><p>Repeat until all LOTs are assigned for each patient.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="example-implementation">Example implementation<a class="anchor" aria-label="anchor" href="#example-implementation"></a>
</h3>
<p>This is a demonstration for situation 1: “Overall line of therapy.”
Note that this takes a few minutes to complete.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pcctc/ironer" class="external-link">ironer</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack prior treatments with on study treatments</span></span>
<span><span class="co"># rename variables to match between two data sets</span></span>
<span><span class="va">treatment_prep</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">medidata</span><span class="op">$</span><span class="va">ca_cm_derived</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>        <span class="va">subject</span>, <span class="va">treatment</span>, <span class="va">exstdat_int</span>, <span class="va">exendat_int</span>, </span>
<span>        treatment_recode <span class="op">=</span> <span class="va">trt_treatment_recode</span>, treatment_category <span class="op">=</span> <span class="va">trt_treatment_category</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># remove entries with missing start date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">exstdat_int</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># remove treatments not counted as a line of therapy</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">treatment_category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Steroid"</span>, <span class="st">"Bone-Modifying Agent"</span>, <span class="st">"Bisphosphonates"</span>, <span class="st">"Antidiabetic"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># keep relevant fields</span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">exstdat_int</span>, <span class="va">exendat_int</span>, <span class="va">treatment_category</span>, <span class="va">treatment_recode</span><span class="op">)</span></span></code></pre></div>
<p>Here is what the prepared data looks like for a single subject:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX"],["2006-12-15","2011-02-04","2011-02-11","2013-05-20","2015-02-13","2016-06-20","2016-06-22","2006-12-15","2018-04-18","2018-04-18","2019-10-01","2020-02-11"],["2007-06-15","2011-03-06","2012-04-30","2014-05-18","2015-11-12","2017-01-06","2017-09-07","2007-06-15",null,"2019-01-30","2020-01-22",null],["ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","AR Signaling Inhibitor","AR Signaling Inhibitor"],["Bicalutamide","Bicalutamide","Leuprolide","Leuprolide","Leuprolide","Bicalutamide","Leuprolide","Leuprolide","Leuprolide","Bicalutamide","Apalutamide","Darolutamide (ODM-201)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>subject<\/th>\n      <th>exstdat_int<\/th>\n      <th>exendat_int<\/th>\n      <th>treatment_category<\/th>\n      <th>treatment_recode<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"name":"subject","targets":0},{"name":"exstdat_int","targets":1},{"name":"exendat_int","targets":2},{"name":"treatment_category","targets":3},{"name":"treatment_recode","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assign line of therapy </span></span>
<span><span class="va">treatment_lot</span> <span class="op">&lt;-</span> <span class="va">treatment_prep</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="co"># sort by subject and treatment start date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">exstdat_int</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># within each subject, assign line of therapy</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">ironer</span><span class="fu">::</span><span class="fu"><a href="../reference/assign_lot.html">assign_lot</a></span><span class="op">(</span></span>
<span>    .data <span class="op">=</span> <span class="va">.x</span>, </span>
<span>    <span class="co"># note, you could use treatment_category here as well to get a high level</span></span>
<span>    <span class="co"># view of line of therapy by category</span></span>
<span>    treatment <span class="op">=</span> <span class="va">treatment_recode</span>,</span>
<span>    dt_trt_observed <span class="op">=</span> <span class="va">exstdat_int</span>, </span>
<span>    dt_treatment_end <span class="op">=</span> <span class="va">exendat_int</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>  </span></code></pre></div>
<p>Example results from a subject. Note that individual treatments are
still retained.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"data":[["XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX"],["2006-12-15","2006-12-15","2011-02-04","2011-02-11","2013-05-20","2015-02-13","2016-06-20","2016-06-22","2018-04-18","2018-04-18","2019-10-01","2020-02-11"],["2007-06-15","2007-06-15","2011-03-06","2012-04-30","2014-05-18","2015-11-12","2017-01-06","2017-09-07","2019-01-30",null,"2020-01-22",null],["ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","AR Signaling Inhibitor","AR Signaling Inhibitor"],["Bicalutamide","Leuprolide","Bicalutamide","Leuprolide","Leuprolide","Leuprolide","Bicalutamide","Leuprolide","Bicalutamide","Leuprolide","Apalutamide","Darolutamide (ODM-201)"],["priorrx","priorrx","priorrx","priorrx","priorrx","priorrx","priorrx","priorrx","treatment","treatment","treatment","treatment"],[1,1,2,2,3,3,4,4,5,5,6,7],["Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Leuprolide","Leuprolide","Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Apalutamide","Darolutamide (ODM-201)"],["2006-12-15","2006-12-15","2011-02-04","2011-02-04","2013-05-20","2013-05-20","2016-06-20","2016-06-20","2018-04-18","2018-04-18","2019-10-01","2020-02-11"],["2007-06-15","2007-06-15","2012-04-30","2012-04-30","2015-11-12","2015-11-12","2017-09-07","2017-09-07","2019-01-30","2019-01-30","2020-01-22","2020-02-11"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>subject<\/th>\n      <th>exstdat_int<\/th>\n      <th>exendat_int<\/th>\n      <th>treatment_category<\/th>\n      <th>treatment_recode<\/th>\n      <th>source<\/th>\n      <th>lot<\/th>\n      <th>regimen<\/th>\n      <th>dt_lot_start<\/th>\n      <th>dt_lot_last_obs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":6},{"name":"subject","targets":0},{"name":"exstdat_int","targets":1},{"name":"exendat_int","targets":2},{"name":"treatment_category","targets":3},{"name":"treatment_recode","targets":4},{"name":"source","targets":5},{"name":"lot","targets":6},{"name":"regimen","targets":7},{"name":"dt_lot_start","targets":8},{"name":"dt_lot_last_obs","targets":9}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>You can reduce the data set to summarized treatment regimens.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_lot_summary</span> <span class="op">&lt;-</span> <span class="va">treatment_lot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">lot</span>, <span class="va">regimen</span>, <span class="va">dt_lot_start</span>, <span class="va">dt_lot_last_obs</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And here is what the same subject would appear as:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"filter":"none","vertical":false,"data":[["XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX","XXX-XX-XXX"],[1,2,3,4,5,6,7],["Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Leuprolide","Bicalutamide, Leuprolide","Bicalutamide, Leuprolide","Apalutamide","Darolutamide (ODM-201)"],["2006-12-15","2011-02-04","2013-05-20","2016-06-20","2018-04-18","2019-10-01","2020-02-11"],["2007-06-15","2012-04-30","2015-11-12","2017-09-07","2019-01-30","2020-01-22","2020-02-11"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>subject<\/th>\n      <th>lot<\/th>\n      <th>regimen<\/th>\n      <th>dt_lot_start<\/th>\n      <th>dt_lot_last_obs<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":20,"columnDefs":[{"className":"dt-right","targets":1},{"name":"subject","targets":0},{"name":"lot","targets":1},{"name":"regimen","targets":2},{"name":"dt_lot_start","targets":3},{"name":"dt_lot_last_obs","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,20,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Shannon Pileggi, Travis Gerke, Patrick Freeman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
