<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comprehensive Ironman Treatment Tutorial • ironer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comprehensive Ironman Treatment Tutorial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ironer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01data-documentation-medidata.html">Medidata data documentation</a></li>
    <li><a class="dropdown-item" href="../articles/02data-documentation-proms.html">PROMS data documentation</a></li>
    <li><a class="dropdown-item" href="../articles/03line-of-therapy.html">Line of therapy algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/04treatment-mapping.html">Treatment mapping</a></li>
    <li><a class="dropdown-item" href="../articles/05comprehensive_ironman_treatment_tutorial.html">Comprehensive Ironman Treatment Tutorial</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pcctc/ironer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="05comprehensive_ironman_treatment_tutorial_files/core-js-2.5.3/shim.min.js"></script><script src="05comprehensive_ironman_treatment_tutorial_files/react-18.2.0/react.min.js"></script><script src="05comprehensive_ironman_treatment_tutorial_files/react-18.2.0/react-dom.min.js"></script><script src="05comprehensive_ironman_treatment_tutorial_files/reactwidget-2.0.0/react-tools.js"></script><link href="05comprehensive_ironman_treatment_tutorial_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="05comprehensive_ironman_treatment_tutorial_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="05comprehensive_ironman_treatment_tutorial_files/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="05comprehensive_ironman_treatment_tutorial_files/reactable-binding-0.4.4/reactable.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comprehensive Ironman Treatment Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pcctc/ironer/blob/main/vignettes/articles/05comprehensive_ironman_treatment_tutorial.Rmd" class="external-link"><code>vignettes/articles/05comprehensive_ironman_treatment_tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>05comprehensive_ironman_treatment_tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview-of-treatment-data">Overview of treatment data<a class="anchor" aria-label="anchor" href="#overview-of-treatment-data"></a>
</h2>
<p>Treatment data is collected in two independent forms:<br></p>
<ol style="list-style-type: decimal">
<li><p>Cancer treatments (<code>ca_cm</code>)<br></p></li>
<li><p>Physician questionnaires (<a href="https://pcctc.github.io/ironer/articles/data-documentation-medidata.html#physician-questionnaires">multiple
versions implemented across protocols</a>)<br></p></li>
</ol>
<p>Data capture differs between the forms; as the forms are independent,
treatments may not align across the forms. The Data Management team
monitors this and issues queries to improve alignment. Your Ironman
research question should inform which source of treatment data to use,
and if it is useful to combine the two sources of treatment
information.</p>
</div>
<div class="section level2">
<h2 id="cancer-treatments-ca_cm">Cancer treatments (<code>ca_cm</code>)<a class="anchor" aria-label="anchor" href="#cancer-treatments-ca_cm"></a>
</h2>
<p>Cancer treatments represent treatments that occurred both prior to
study enrollment and on study. Data is collected as log lines, with one
row per treatment. Cancer treatments could be used for any time-to-event
analyses where exact start and stop date of treatments is required.</p>
<p>Each entry includes treatment name, start date, stop date,
modification reason, discontinuation reason, and indication. Indication
was added June 2024 when the prior and on study treatment forms were
consolidated to a single form.</p>
<p>The <code>ca_cm</code> table represents the raw cancer treatment data
collected in medidata. The <code>ca_cm_derived</code> table additionally
contains higher level treatment categories, standardized treatment
coding, and flags for taxels and NHAs (novel hormonal agents).</p>
<div class="section level4">
<h4 id="additional-considerations-for-analysis">Additional considerations for analysis:<a class="anchor" aria-label="anchor" href="#additional-considerations-for-analysis"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>It could be assumed that all patients on anti-androgen are
simultaneously on ADT, even if ADT is not reported. Note this may vary
globally.</p></li>
<li><p>It could be assumed that a patient is continuing ADT if it was
ever marked as “so far”.</p></li>
<li><p>It could be assumed that patients with mHSPC are on ADT, even if
not marked. This can be cross checked against treatments.</p></li>
<li><p>If a systemic treatment is listed in “so far” but “starting” is
blank, the visit associated with “so far” treatment could be imputed as
their initial on study treatment.</p></li>
<li><p>Consider ignoring external beam radiation therapy in treatment
regimen. (“We often will have patients with mHSPC get radiation to a
painful lesion or something along with starting systemic
therapy.)</p></li>
<li><p>There is data on orchiectomies in the <code>prsurg</code> and
<code>surg</code> tables that can be incorporated.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="gather-minimal-data-from-cancer-treatments-form">Gather minimal data from cancer treatments form<a class="anchor" aria-label="anchor" href="#gather-minimal-data-from-cancer-treatments-form"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_treatments_all</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">ca_cm_derived</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">subject</span>,</span>
<span>    treatment <span class="op">=</span> <span class="va">trt_treatment_recode</span>,</span>
<span>    dt_treatment_start <span class="op">=</span> <span class="va">exstdat_int</span>,</span>
<span>    dt_treatment_end <span class="op">=</span> <span class="va">exendat_int</span>,</span>
<span>    treatment_category <span class="op">=</span> <span class="va">trt_treatment_category</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># remove blank treatments</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="co"># sort by treatment start date within subject</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">dt_treatment_start</span><span class="op">)</span></span></code></pre></div>
<p>Here is an example of what the data looks like for a single patient.
Dates have been shifted to protect the patient’s identity.</p>
<div class="reactable html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"subject":[1,1,1,1,1,1,1,1,1,1,1],"treatment":["Leuprolide","Abemaciclib/Placebo","Abiraterone Acetate","Prednisone","Dexamethasone","Cabazitaxel","Prednisolone","Enzalutamide","Etoposide","Cisplatin","Prednisolone"],"dt_treatment_start":["2018-10-02","2019-08-09","2019-08-09","2019-08-09","2020-05-30","2020-07-09","2020-07-09","2021-01-15","2021-05-06","2021-05-06","2021-05-06"],"dt_treatment_end":["2021-11-06","2020-06-02","2020-06-05","2020-06-04","2021-11-06","2020-12-25","2020-12-25","2021-03-12","2021-06-19","2021-06-19","2021-06-19"],"treatment_category":["ADT","CDK Inhibitor/Placebo","AR Signaling Inhibitor","Steroid","Steroid","Chemotherapy","Steroid","AR Signaling Inhibitor","Chemotherapy","Chemotherapy","Steroid"]},"columns":[{"id":"subject","name":"subject","type":"numeric","minWidth":190},{"id":"treatment","name":"treatment","type":"character","minWidth":190},{"id":"dt_treatment_start","name":"dt_treatment_start","type":"Date","minWidth":190},{"id":"dt_treatment_end","name":"dt_treatment_end","type":"Date","minWidth":190},{"id":"treatment_category","name":"treatment_category","type":"character","minWidth":190}],"resizable":true,"dataKey":"7f99f52b219d3625d0b50af47ce542fc"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="treatments-and-treatment-categories">Treatments and treatment categories<a class="anchor" aria-label="anchor" href="#treatments-and-treatment-categories"></a>
</h4>
<p>Depending on your research question, you may want to exclude
treatments or treatment categories that are not relevant for your
analysis. The table below displays all treatments and their
categorization.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_treatments_all</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">treatment_category</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">reactable</span><span class="op">(</span></span>
<span>    resizable <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="reactable html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"treatment_category":["ADT","ADT","ADT","ADT","ADT","ADT","ADT","ADT","AR Signaling Inhibitor","AR Signaling Inhibitor","AR Signaling Inhibitor","AR Signaling Inhibitor","Antidiabetic","Bisphosphonates","Bone-Modifying Agent","CDK Inhibitor/Placebo","Chemotherapy","Chemotherapy","Chemotherapy","Chemotherapy","Chemotherapy","Chemotherapy","Immunotherapy","Immunotherapy","Immunotherapy","Multi-kinase Inhibitor","PARP","Radiopharmaceuticals","Radiopharmaceuticals","Radiopharmaceuticals","Steroid","Steroid","Steroid"],"treatment":["ADT","Bicalutamide","Degarelix","Goserelin","Leuprolide","Leuprorelin","Relugolix","Triptorelin","Abiraterone Acetate","Apalutamide","Darolutamide (ODM-201)","Enzalutamide","Metformin","Zoledronic acid","Denosumab","Abemaciclib/Placebo","Cabazitaxel","Carboplatin","Cisplatin","Cyclophosphamide","Docetaxel","Etoposide","Nivolumab","Pembrolizumab","Sipuleucel-T","ESK981","Olaparib","177Lu-PSMA-617","Lutetium-177","Radium-223","Dexamethasone","Prednisolone","Prednisone"],"n":[3,44,26,21,41,14,1,8,48,10,2,30,1,1,4,2,12,1,1,3,42,2,1,2,2,1,1,1,3,5,1,7,17]},"columns":[{"id":"treatment_category","name":"treatment_category","type":"character"},{"id":"treatment","name":"treatment","type":"character"},{"id":"n","name":"n","type":"numeric"}],"resizable":true,"dataKey":"2a9a59a911b06c0fd5ab83624948b274"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script><p>Be aware that the ADT (Androgen Deprivation Therapy) treatment
classification includes LHRH agonists, LHRH antagonists, and
anti-androgens. Depending on your research question, you may want to
implement a different treatment classification that more narrowly
defines ADTs of interest.</p>
</div>
<div class="section level4">
<h4 id="removing-ineligible-treatments">Removing ineligible treatments<a class="anchor" aria-label="anchor" href="#removing-ineligible-treatments"></a>
</h4>
<p>Occasionally treatments that are not specifically cancer treatments
are entered in medidata. The following code excludes treatment
categories that are not specific to prostate cancer. This list should be
regularly assessed to ensure it is up to date and accurate as new data
gets entered.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vector of treatment categories that are not specifically prostate cancer treatments</span></span>
<span><span class="co"># and could be excluded from analysis of prostate cancer specific treatments</span></span>
<span><span class="va">trt_category_exclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Steroid"</span>, <span class="st">"Antidiabetic"</span>, <span class="st">"Antilipemic"</span>, <span class="st">"Nutraceuticals"</span>, <span class="st">"Bone-Modifying Agent"</span>,</span>
<span>  <span class="st">"Bisphosphonates"</span>, <span class="st">"Nutraceutical"</span>, <span class="st">"Nutraceutical/Placebo"</span>, <span class="st">"Placebo"</span>, <span class="st">"COX-2 Inhibitor"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># create a new data frame that represents prostate cancer (pc) treatments only </span></span>
<span><span class="va">df_treatments_pc</span> <span class="op">&lt;-</span> <span class="va">df_treatments_all</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># exclude these drug classes</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">treatment_category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">trt_category_exclude</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="collapsing-consecutive-treatments">Collapsing consecutive treatments<a class="anchor" aria-label="anchor" href="#collapsing-consecutive-treatments"></a>
</h4>
<p>Occasionally treatments are entered on different log lines but with
no break between the treatment end date and the next treatment start
date. For example, consider this subject history which shows
Bicalutamide continuing between rows 5 and 6, and then again between
rows 7 and 8.</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;     row treatment    dt_treatment_start dt_treatment_end</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Bicalutamide 2001-04-09         2003-04-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Bicalutamide 2008-06-01         2008-09-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Bicalutamide 2009-06-24         2009-12-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Bicalutamide 2010-10-08         2011-06-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Bicalutamide 2012-09-01         2013-11-26      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 Bicalutamide 2013-11-26         2014-12-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     7 Bicalutamide 2015-01-01         2016-07-26      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     8 Bicalutamide 2016-07-27         2017-04-04</span></span></code></pre>
<p>For analysis purposes, this could be considered a single treatment of
Bicalutamide represented by 6 rows instead of 8.</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;     row treatment    dt_treatment_start dt_treatment_end</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Bicalutamide 2001-04-09         2003-04-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Bicalutamide 2008-06-01         2008-09-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Bicalutamide 2009-06-24         2009-12-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Bicalutamide 2010-10-08         2011-06-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Bicalutamide 2012-09-01         2014-12-01      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 Bicalutamide 2015-01-01         2017-04-04</span></span></code></pre>
<p>This code will collapse consecutive or overlapping records of the
same treatment.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_treatments_pc_collapsed</span> <span class="op">&lt;-</span> <span class="va">df_treatments_pc</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span></span>
<span>     <span class="va">subject</span>, </span>
<span>     <span class="va">treatment</span>,</span>
<span>     <span class="va">dt_treatment_start</span>, </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">dt_treatment_end</span><span class="op">)</span></span>
<span>     <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># examine each treatment within a subject</span></span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">treatment</span><span class="op">)</span>,</span>
<span>    <span class="co"># create a flag that represents truly unique lines of treatment</span></span>
<span>    flag_unique_line <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># the first record represents a unique line</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>      <span class="co"># if treatment start date is after the previous treatment end date plus one,</span></span>
<span>      <span class="co"># then we assume it represents a new line for that treatment.</span></span>
<span>      <span class="va">dt_treatment_start</span> <span class="op">&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">dt_treatment_end</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>      <span class="co"># otherwise, if the treatment start date occurs before the previous treatment </span></span>
<span>      <span class="co"># end date plus one, this is not a unique line</span></span>
<span>      <span class="va">dt_treatment_start</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">dt_treatment_end</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">~</span> <span class="cn">FALSE</span>,</span>
<span>      <span class="co"># for instance of missing start or end date, the default value will assume a new new line</span></span>
<span>      .default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="co"># create a grouping variable that represents the total number of unique lines</span></span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">flag_unique_line</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># # examine each treatment grouping within a subject</span></span>
<span>  <span class="co"># for overlapping entries for a drug, take the earlier start date and later end date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">treatment</span>, <span class="va">group</span><span class="op">)</span>,</span>
<span>    dt_treatment_start_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">dt_treatment_start</span>, na_rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    dt_treatment_end_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">last</a></span><span class="op">(</span><span class="va">dt_treatment_end</span>, na_rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span></span>
<span>    <span class="va">subject</span>, </span>
<span>    <span class="va">treatment</span>, </span>
<span>    dt_treatment_start <span class="op">=</span> <span class="va">dt_treatment_start_group</span>, </span>
<span>    dt_treatment_end <span class="op">=</span> <span class="va">dt_treatment_end_group</span>, </span>
<span>    <span class="va">treatment_category</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span></span>
<span>    <span class="va">subject</span>, <span class="va">dt_treatment_start</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="assigning-line-of-therapy-lot">Assigning Line of Therapy (LOT)<a class="anchor" aria-label="anchor" href="#assigning-line-of-therapy-lot"></a>
</h4>
<p>The treatments form captures individual treatments, but does not
capture if treatments are administered simultaneously or line of therapy
(LOT) for that treatment.</p>
<p>The line of the therapy for a given treatment can be approximately
derived using the <a href="https://pcctc.github.io/ironer/reference/assign_lot.html"><code>ironer::assign_lot</code></a>
function. Treatments are considered to be in the same LOT if their start
dates are within 30 days. Treatment end dates are not considered in
defining LOTs.</p>
<p><strong>Considerations:</strong></p>
<ul>
<li>
<p>ADT usage</p>
<ul>
<li><p>ADT is not consistently captured, and the documentation or usage
of ADT varies globally.</p></li>
<li><p>About 50% of mHSPC patients have ADT documented in the
database.</p></li>
<li><p>You could consider excluding ADT when creating lines of therapy,
and assume ADT usage even if not documented.</p></li>
</ul>
</li>
<li><p>The code below considers all treatments initiated within 90 days
of enrollment as per protocol patients must be enrolled within 90 days
of starting systemic treatment. This can be modified as needed.</p></li>
<li><p>The function can be used to assign line of therapy based on
either the treatment category or the specific treatment itself.</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identify on study treatments</span></span>
<span><span class="va">df_treatments_onstudy</span> <span class="op">&lt;-</span> <span class="va">df_treatments_pc_collapsed</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># include consent date in order to exclude treatments &gt;90 days before enrollment</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">ic</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">cnstdate_int</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"subject"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># day of treatment relative to consent date</span></span>
<span>    trt_day_rel_consent <span class="op">=</span> <span class="va">dt_treatment_start</span> <span class="op">-</span> <span class="va">cnstdate_int</span>,</span>
<span>    <span class="co"># consider treatment to be on study if within 90 days of consent date</span></span>
<span>    trt_on_study <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">trt_day_rel_consent</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">90</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># retain only on study treatments</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">trt_on_study</span><span class="op">)</span></span></code></pre></div>
<p>Identify first line of therapy on study.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assign LOT while on study, by treatment category</span></span>
<span><span class="co"># be patient, this takes a bit to run</span></span>
<span><span class="co"># the result is the same dimension as the input data, i.e., one row per treatment</span></span>
<span><span class="va">df_lot_trt</span> <span class="op">&lt;-</span> <span class="va">df_treatments_onstudy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">dt_treatment_start</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="../reference/assign_lot.html">assign_lot</a></span><span class="op">(</span></span>
<span>    <span class="va">.x</span>, <span class="va">treatment_category</span>, <span class="va">dt_treatment_start</span>, <span class="va">dt_treatment_end</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># modify the result to be one row per line of therapy</span></span>
<span><span class="co"># additionally retain all treatments in that line of therapy </span></span>
<span><span class="va">df_lot</span> <span class="op">&lt;-</span> <span class="va">df_lot_trt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">subject</span>, </span>
<span>    <span class="va">cnstdate_int</span>,</span>
<span>    <span class="va">treatment</span>,</span>
<span>    lot_on_study <span class="op">=</span> <span class="va">lot</span>, </span>
<span>    regimen_on_study <span class="op">=</span> <span class="va">regimen</span>, </span>
<span>    <span class="va">dt_lot_start</span>, </span>
<span>    <span class="va">dt_lot_last_obs</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># occasionally, identical treatments are consecutive and estimated to be part of </span></span>
<span>  <span class="co"># the same LOT. distinct() here reduces the identical and consecutive treatments</span></span>
<span>  <span class="co"># to one row</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># create an indicator for observed treatments, to be used in pivot</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trt_ind <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># create a single variable that represents all treatment in LOT</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">lot_on_study</span>, <span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">lot_on_study</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trt_on_study <span class="op">=</span> <span class="fu">str_c</span><span class="op">(</span><span class="va">treatment</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, .after <span class="op">=</span> <span class="va">regimen_on_study</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># this makes treatment columns show in alphabetical order in the pivot step</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># wrangle the data from long to wide to create 1 row per LOT, with indicators</span></span>
<span>  <span class="co"># for each individual treatment</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span></span>
<span>    <span class="co"># creates column names from the pivot</span></span>
<span>    names_from <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>    <span class="co"># observed treatments are given a value of 1</span></span>
<span>    values_from <span class="op">=</span> <span class="va">trt_ind</span>,</span>
<span>    <span class="co"># treatments not observed are filled with a value of 0</span></span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">lot_on_study</span>, <span class="va">dt_lot_start</span><span class="op">)</span></span></code></pre></div>
<p>Here is an example of what the LOT data looks like for a single
patient. Dates have been shifted to protect the patient’s identity.</p>
<div class="reactable html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"subject":[1,1,1,1,1],"cnstdate_int":["2018-10-14","2018-10-14","2018-10-14","2018-10-14","2018-10-14"],"lot_on_study":[1,2,3,4,5],"regimen_on_study":["ADT","AR Signaling Inhibitor, CDK Inhibitor/Placebo","Chemotherapy","AR Signaling Inhibitor","Chemotherapy"],"trt_on_study":["Leuprolide","Abemaciclib/Placebo, Abiraterone Acetate","Cabazitaxel","Enzalutamide","Cisplatin, Etoposide"],"dt_lot_start":["2018-10-02","2019-08-09","2020-07-09","2021-01-15","2021-05-06"],"dt_lot_last_obs":["2021-11-06","2020-06-05","2020-12-25","2021-03-12","2021-06-19"],"177Lu-PSMA-617":[0,0,0,0,0],"ADT":[0,0,0,0,0],"Abemaciclib/Placebo":[0,1,0,0,0],"Abiraterone Acetate":[0,1,0,0,0],"Apalutamide":[0,0,0,0,0],"Bicalutamide":[0,0,0,0,0],"Cabazitaxel":[0,0,1,0,0],"Carboplatin":[0,0,0,0,0],"Cisplatin":[0,0,0,0,1],"Cyclophosphamide":[0,0,0,0,0],"Darolutamide (ODM-201)":[0,0,0,0,0],"Degarelix":[0,0,0,0,0],"Docetaxel":[0,0,0,0,0],"ESK981":[0,0,0,0,0],"Enzalutamide":[0,0,0,1,0],"Etoposide":[0,0,0,0,1],"Goserelin":[0,0,0,0,0],"Leuprolide":[1,0,0,0,0],"Leuprorelin":[0,0,0,0,0],"Lutetium-177":[0,0,0,0,0],"Nivolumab":[0,0,0,0,0],"Olaparib":[0,0,0,0,0],"Pembrolizumab":[0,0,0,0,0],"Radium-223":[0,0,0,0,0],"Sipuleucel-T":[0,0,0,0,0],"Triptorelin":[0,0,0,0,0]},"columns":[{"id":"subject","name":"subject","type":"numeric","minWidth":180},{"id":"cnstdate_int","name":"cnstdate_int","type":"Date","minWidth":180},{"id":"lot_on_study","name":"lot_on_study","type":"numeric","minWidth":180},{"id":"regimen_on_study","name":"regimen_on_study","type":"character","minWidth":180},{"id":"trt_on_study","name":"trt_on_study","type":"character","minWidth":180},{"id":"dt_lot_start","name":"dt_lot_start","type":"Date","minWidth":180},{"id":"dt_lot_last_obs","name":"dt_lot_last_obs","type":"Date","minWidth":180},{"id":"177Lu-PSMA-617","name":"177Lu-PSMA-617","type":"numeric","minWidth":180},{"id":"ADT","name":"ADT","type":"numeric","minWidth":180},{"id":"Abemaciclib/Placebo","name":"Abemaciclib/Placebo","type":"numeric","minWidth":180},{"id":"Abiraterone Acetate","name":"Abiraterone Acetate","type":"numeric","minWidth":180},{"id":"Apalutamide","name":"Apalutamide","type":"numeric","minWidth":180},{"id":"Bicalutamide","name":"Bicalutamide","type":"numeric","minWidth":180},{"id":"Cabazitaxel","name":"Cabazitaxel","type":"numeric","minWidth":180},{"id":"Carboplatin","name":"Carboplatin","type":"numeric","minWidth":180},{"id":"Cisplatin","name":"Cisplatin","type":"numeric","minWidth":180},{"id":"Cyclophosphamide","name":"Cyclophosphamide","type":"numeric","minWidth":180},{"id":"Darolutamide (ODM-201)","name":"Darolutamide (ODM-201)","type":"numeric","minWidth":180},{"id":"Degarelix","name":"Degarelix","type":"numeric","minWidth":180},{"id":"Docetaxel","name":"Docetaxel","type":"numeric","minWidth":180},{"id":"ESK981","name":"ESK981","type":"numeric","minWidth":180},{"id":"Enzalutamide","name":"Enzalutamide","type":"numeric","minWidth":180},{"id":"Etoposide","name":"Etoposide","type":"numeric","minWidth":180},{"id":"Goserelin","name":"Goserelin","type":"numeric","minWidth":180},{"id":"Leuprolide","name":"Leuprolide","type":"numeric","minWidth":180},{"id":"Leuprorelin","name":"Leuprorelin","type":"numeric","minWidth":180},{"id":"Lutetium-177","name":"Lutetium-177","type":"numeric","minWidth":180},{"id":"Nivolumab","name":"Nivolumab","type":"numeric","minWidth":180},{"id":"Olaparib","name":"Olaparib","type":"numeric","minWidth":180},{"id":"Pembrolizumab","name":"Pembrolizumab","type":"numeric","minWidth":180},{"id":"Radium-223","name":"Radium-223","type":"numeric","minWidth":180},{"id":"Sipuleucel-T","name":"Sipuleucel-T","type":"numeric","minWidth":180},{"id":"Triptorelin","name":"Triptorelin","type":"numeric","minWidth":180}],"resizable":true,"dataKey":"6d2aa61d7995a29ab4a80a84ca89858e"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="treatments-from-physician-questionnaires-pq">Treatments from Physician Questionnaires (PQ)<a class="anchor" aria-label="anchor" href="#treatments-from-physician-questionnaires-pq"></a>
</h2>
<p>The Physician Questionnaire (PQ) should be completed by the treating
physician at baseline and at every 3-month visit. Each questionnaire
asks what treatments the patient has received so far and which
treatments the patient is starting. There are currently five versions of
the PQ that must be combined for analysis (PQs were amended at various
protocol amendments). Each version is a separate table in the database
with different variable names. The following table shows the questions
and responses for each version of the PQ.</p>
<p>PQ treatments are useful to assess the cross-sectional association
between treatment and other PQ or PROM measures that are linked to a
visit. There are no specific dates for treatment in the PQ, so it is
challenging to use them for time-to-event analyses.</p>
<p>The date the PQ was entered in the edc is in the field
<code>record_date</code> (though this does not necessarily correspond to
the date the PQ was completed by the physician). Each PQ is associated
with a visit (like <code>Baseline</code>, <code>Month 3</code>, etc),
and those visit dates could be brought in from the <code>cyc_date</code>
form.</p>
<table style="width:99%;" class="table">
<colgroup>
<col width="7%">
<col width="7%">
<col width="52%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>PQ version</th>
<th>Table in Database</th>
<th>Questions asked</th>
<th>Responses</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Versions 1 and 2</td>
<td>pq</td>
<td>
<p>Please list this patient’s CURRENT / CHANGE IN TREATMENT(S)</p>
<p>Are you planning on continuing androgen deprivation therapy for this
patient?</p>
</td>
<td>
<p>Open text field</p>
<p>Yes/No</p>
</td>
</tr>
<tr class="even">
<td>Version 3</td>
<td>new_pq</td>
<td>
<p>What systemic treatments has your patient previously received for
his prostate cancer? Choose all that apply.</p>
<p>What treatment is your patient starting? May select more than one if
in combination</p>
</td>
<td><ul>
<li>
<p>Androgen deprivation therapy (surgical castration, LH-RH
agonist/antagonist)</p>
<ul>
<li>option for first question only</li>
</ul>
</li>
<li><p>Enzalutamide</p></li>
<li><p>Abiraterone acetate</p></li>
<li><p>Docetaxel chemotherapy</p></li>
<li><p>Radium-223 dichloride</p></li>
<li><p>Sipuleucel-T</p></li>
<li><p>Cabazitaxel chemotherapy</p></li>
<li><p>Bicalutamide, or other anti-androgen</p></li>
<li><p>Clinical Trial</p></li>
<li><p>Other _______________</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>Version 4</td>
<td>new_pq_v4</td>
<td>What systemic treatment(s) has your patient received so far and
which one(s) is he starting now? In both columns, choose all that
apply.</td>
<td><ul>
<li><p>Abiraterone</p></li>
<li><p>Androgen deprivation (LHRH, surgical)</p></li>
<li><p>Apalutamide</p></li>
<li><p>Bicalutamide or other anti-androgen</p></li>
<li><p>Cabazitaxel</p></li>
<li><p>Clinical trial</p></li>
<li><p>Docetaxel</p></li>
<li><p>Enzalutamide</p></li>
<li><p>External beam radiation therapy for metastatic disease</p></li>
<li><p>Radium-223</p></li>
<li><p>Sipuleucel-T</p></li>
<li><p>Other cancer-directed therapy (e.g., mitoxantrone)</p></li>
<li><p>Symptom-oriented therapy only (e.g., analgesics)</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Version 5</td>
<td>new_pq_v5</td>
<td>What systemic treatment(s) has your patient received so far and
which one(s) ishe starting now? In both columns, choose all that
apply.</td>
<td><ul>
<li><p>Abiraterone</p></li>
<li><p>Androgen deprivation (LHRH, surgical)</p></li>
<li><p>Apalutamide</p></li>
<li><p>Bicalutamide or other anti-androgen</p></li>
<li><p>Cabazitaxel</p></li>
<li><p>Clinical trial</p></li>
<li><p>Docetaxel</p></li>
<li><p>Enzalutamide</p></li>
<li><p>External beam radiation therapy for metastatic disease</p></li>
<li><p>Radium-223</p></li>
<li><p>Sipuleucel-T</p></li>
<li><p>Other cancer-directed therapy (e.g., mitoxantrone)</p></li>
<li><p>Symptom-oriented therapy only (e.g., analgesics)</p></li>
<li><p>Darolutamide</p></li>
<li><p>Niraparib</p></li>
<li><p>Olaparib</p></li>
<li><p>Rucaparib</p></li>
<li><p>Talazoparib</p></li>
<li><p>Pembrolizumab</p></li>
<li><p>177Lu-PSMA-617</p></li>
</ul></td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="pq-version-1-and-2">PQ version 1 and 2<a class="anchor" aria-label="anchor" href="#pq-version-1-and-2"></a>
</h4>
<p>Protocol versions 1 and 2 use the same version of the physician
questionnaire. Due to the open text nature, it is challenging to
standardize treatments.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use variable naming conventions that align with other pq aggregations</span></span>
<span><span class="va">df_pq1</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">pq</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pq_version <span class="op">=</span> <span class="st">"pq1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pq_version</span>, <span class="va">subject</span>, <span class="va">instance_name</span>, treatment <span class="op">=</span> <span class="va">pq1</span>, continuing_adt <span class="op">=</span> <span class="va">pq2</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pq-version-3">PQ version 3<a class="anchor" aria-label="anchor" href="#pq-version-3"></a>
</h4>
<p>For PQ3, pull data in two separate steps: one for so far treatments
and one for starting treatments. Then combine.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve so far treatments</span></span>
<span><span class="va">df_pq3_sofar</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">new_pq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"^newpq_4[a-i]$"</span><span class="op">)</span>, <span class="va">newpq_4iab</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># standardize treatment name through label</span></span>
<span>  <span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="https://larmarange.github.io/labelled/reference/var_label.html" class="external-link">set_variable_labels</a></span><span class="op">(</span></span>
<span>    newpq_4a <span class="op">=</span> <span class="st">"ADT"</span>,</span>
<span>    newpq_4c <span class="op">=</span> <span class="st">"Abiraterone"</span>,</span>
<span>    newpq_4d <span class="op">=</span> <span class="st">"Docetaxel"</span>,</span>
<span>    newpq_4e <span class="op">=</span> <span class="st">"Radium-223"</span>,</span>
<span>    newpq_4g <span class="op">=</span> <span class="st">"Cabazitaxel"</span>,</span>
<span>    newpq_4h <span class="op">=</span> <span class="st">"Anti-androgen"</span>,</span>
<span>    newpq_4i <span class="op">=</span> <span class="st">"Clinical trial"</span>, <span class="co"># to standardize name across other PQs</span></span>
<span>    subject <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    instance_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    newpq_4iab <span class="op">=</span> <span class="st">"sofar_Other"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># convert label to variable name</span></span>
<span>  <span class="fu">sjlabelled</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/sjlabelled/reference/label_to_colnames.html" class="external-link">label_to_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># create a set of new columns that contain the character string</span></span>
<span>  <span class="co"># representing treatment continued so far</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="va">sofar_Other</span><span class="op">)</span>, </span>
<span>      .names <span class="op">=</span> <span class="st">"sofar_{.col}"</span>, </span>
<span>      .fns <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">x</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fu">var_label</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"sofar"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">sofar_Other</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve starting treatments</span></span>
<span><span class="va">df_pq3_starting</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">new_pq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"^newpq_5[a-h]"</span><span class="op">)</span>, <span class="va">newpq_5ia</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># standardize treatment name through label</span></span>
<span>  <span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="https://larmarange.github.io/labelled/reference/var_label.html" class="external-link">set_variable_labels</a></span><span class="op">(</span></span>
<span>    newpq_5b <span class="op">=</span> <span class="st">"Abiraterone"</span>,</span>
<span>    newpq_5c <span class="op">=</span> <span class="st">"Docetaxel"</span>,</span>
<span>    newpq_5d <span class="op">=</span> <span class="st">"Radium-223"</span>,</span>
<span>    newpq_5f <span class="op">=</span> <span class="st">"Cabazitaxel"</span>,</span>
<span>    newpq_5g <span class="op">=</span> <span class="st">"Anti-androgen"</span>,</span>
<span>    newpq_5h <span class="op">=</span> <span class="st">"Clinical trial"</span>,  <span class="co"># to standardize name across other PQs</span></span>
<span>    subject <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    instance_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    newpq_5ia <span class="op">=</span> <span class="st">"starting_Other"</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># convert label to variable name</span></span>
<span>  <span class="fu">sjlabelled</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/sjlabelled/reference/label_to_colnames.html" class="external-link">label_to_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># create a set of new columns that contain the character string</span></span>
<span>  <span class="co"># representing treatment starting</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="va">starting_Other</span><span class="op">)</span>, </span>
<span>      .names <span class="op">=</span> <span class="st">"starting_{.col}"</span>, </span>
<span>      .fns <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">x</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fu">var_label</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"starting"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">starting_Other</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge so far and starting treatments</span></span>
<span><span class="va">df_pq3</span> <span class="op">&lt;-</span> <span class="va">df_pq3_sofar</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_pq3_starting</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject"</span>, <span class="st">"instance_name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pq-version-4">PQ version 4<a class="anchor" aria-label="anchor" href="#pq-version-4"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_pq4</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">new_pq_v4</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"^newpq14[a-m]_v4"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"std"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="https://larmarange.github.io/labelled/reference/var_label.html" class="external-link">set_variable_labels</a></span><span class="op">(</span></span>
<span>    newpq14b_v4 <span class="op">=</span> <span class="st">"ADT"</span>,</span>
<span>    newpq14d_v4 <span class="op">=</span> <span class="st">"Anti-androgen"</span>,</span>
<span>    newpq14i_v4 <span class="op">=</span> <span class="st">"EBRT"</span>,</span>
<span>    newpq14m_v4 <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>    subject <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    instance_name <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sjlabelled</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/sjlabelled/reference/label_to_colnames.html" class="external-link">label_to_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># create a set of columns for so far treatments</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span><span class="op">)</span>, </span>
<span>      .names <span class="op">=</span> <span class="st">"sofar_{.col}"</span>, </span>
<span>      .fns <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">x</span> <span class="op">==</span> <span class="st">"So far"</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">cur_column</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># create a set of columns for starting treatments</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"sofar"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      .names <span class="op">=</span> <span class="st">"starting_{.col}"</span>, </span>
<span>      .fns <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">x</span> <span class="op">==</span> <span class="st">"Starting now"</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">cur_column</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"sofar"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"starting"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pq-version-5">PQ version 5<a class="anchor" aria-label="anchor" href="#pq-version-5"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_pq5</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">new_pq_v5</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"^newpq14[a-u,]_v5"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"std"</span>, <span class="st">"14n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="https://larmarange.github.io/labelled/reference/var_label.html" class="external-link">set_variable_labels</a></span><span class="op">(</span></span>
<span>    newpq14b_v5 <span class="op">=</span> <span class="st">"ADT"</span>,</span>
<span>    newpq14d_v5 <span class="op">=</span> <span class="st">"Anti-androgen"</span>,</span>
<span>    newpq14i_v5 <span class="op">=</span> <span class="st">"EBRT"</span>,</span>
<span>    newpq14m_v5 <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>    subject <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    instance_name <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sjlabelled</span><span class="fu">::</span><span class="fu"><a href="https://strengejacke.github.io/sjlabelled/reference/label_to_colnames.html" class="external-link">label_to_colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># create a set of columns for so far treatments</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span><span class="op">)</span>, </span>
<span>      .names <span class="op">=</span> <span class="st">"sofar_{.col}"</span>, </span>
<span>      .fns <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">x</span> <span class="op">==</span> <span class="st">"So far"</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">cur_column</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># create a set of columns for starting treatments</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"sofar"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      .names <span class="op">=</span> <span class="st">"starting_{.col}"</span>, </span>
<span>      .fns <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>          <span class="va">x</span> <span class="op">==</span> <span class="st">"Starting now"</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">cur_column</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"sofar"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"starting"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combine-data-from-all-pqs">Combine data from all PQs<a class="anchor" aria-label="anchor" href="#combine-data-from-all-pqs"></a>
</h4>
<p>This creates a wide data set combining PQs versions 3, 4 and 5 with a
set of columns for treatments continuing so far and treatment that are
starting.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack the three questionnaires </span></span>
<span><span class="va">df_pq_345</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="st">"pq3"</span> <span class="op">=</span> <span class="va">df_pq3</span>,</span>
<span>    <span class="st">"pq4"</span> <span class="op">=</span> <span class="va">df_pq4</span>,</span>
<span>    <span class="st">"pq5"</span> <span class="op">=</span> <span class="va">df_pq5</span>,</span>
<span>    <span class="co"># create an identifier displaying questionnaire source</span></span>
<span>    .id <span class="op">=</span> <span class="st">"pq_version"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># clean variable names </span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># create a single column concatenating all so far treatments</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"sofar_"</span><span class="op">)</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"sofar_trt"</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">", "</span>, </span>
<span>    remove <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># create a single column concatenating all starting treatments</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"starting_"</span><span class="op">)</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"starting_trt"</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">", "</span>, </span>
<span>    remove <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> </span></code></pre></div>
<p>Identify the date associated with visits.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_visit_date</span> <span class="op">&lt;-</span> <span class="va">lst_blind_medidata</span><span class="op">$</span><span class="va">cyc_date</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span>, <span class="va">visit_date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># remove observations with missing date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">visit_date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># in case of duplicate entries, retain distinct rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Create a data frame with information from all available PQs.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_pq_long</span> <span class="op">&lt;-</span> <span class="va">df_pq_345</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sofar_trt</span>, <span class="va">starting_trt</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pq_version</span>, <span class="va">subject</span>, <span class="va">instance_name</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"status"</span>, <span class="st">"pq_coded_trt"</span><span class="op">)</span>,</span>
<span>    <span class="co"># separate column names by first underscore</span></span>
<span>    names_pattern <span class="op">=</span> <span class="st">"^([^_]+)_(.*)"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df_pq1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># join in dates associated with visit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_visit_date</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject"</span>, <span class="st">"instance_name"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">visit_date</span>, .after <span class="op">=</span> <span class="va">instance_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">instance_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># in case of duplicate entries caused by the pivot, retain distinct rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here is an example of what the combined pq data looks like for a
single patient.</p>
<div class="reactable html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"pq_version":["pq3","pq3","pq3","pq4","pq4","pq4","pq4","pq4","pq4","pq4","pq4","pq4"],"subject":[66,66,66,66,66,66,66,66,66,66,66,66],"instance_name":["Baseline 0","Baseline 0","Baseline 0","Month 12","Month 12","Month 12","Month 15","Month 15","Month 15","Month 15","Month 9","Month 9"],"visit_date":["2018-04-01","2018-04-01","2018-04-01","2019-04-07","2019-04-07","2019-04-07","2019-06-15","2019-06-15","2019-06-15","2019-06-15","2018-12-30","2018-12-30"],"status":["sofar","starting","starting","sofar","sofar","starting","sofar","sofar","sofar","starting","sofar","starting"],"pq_coded_trt":["adt","enzalutamide","clinical_trial","enzalutamide","clinical_trial","docetaxel","enzalutamide","docetaxel","clinical_trial","abiraterone","enzalutamide","clinical_trial"],"treatment":["ADT","Enzalutamide","Clinical trial","Enzalutamide","Clinical trial","Docetaxel","Enzalutamide","Docetaxel","Clinical trial","Abiraterone","Enzalutamide","Clinical trial"],"continuing_adt":[null,null,null,null,null,null,null,null,null,null,null,null]},"columns":[{"id":"pq_version","name":"pq_version","type":"character","resizable":true,"minWidth":170},{"id":"subject","name":"subject","type":"numeric","resizable":true,"minWidth":170},{"id":"instance_name","name":"instance_name","type":"character","resizable":true,"minWidth":170},{"id":"visit_date","name":"visit_date","type":"Date","resizable":true,"minWidth":170},{"id":"status","name":"status","type":"character","resizable":true,"minWidth":170},{"id":"pq_coded_trt","name":"pq_coded_trt","type":"character","resizable":true,"minWidth":170},{"id":"treatment","name":"treatment","type":"character","resizable":true,"minWidth":170},{"id":"continuing_adt","name":"continuing_adt","type":"character","resizable":true,"minWidth":170}],"dataKey":"e995f7fe0045efd9e530851be4055387"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Shannon Pileggi, Travis Gerke, Patrick Freeman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
